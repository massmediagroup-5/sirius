/** * Product model cart item */var WholesaleProductCartItem = (function () {    /**     * @param $item     * @constructor     */    function WholesaleProductCartItem($item) {        this.$item = $item;        this.packageFlag = this.$item.data('package');        this.$amountsChanger = this.$item.find('.js_amounts_changer');        this.$removeBtn = this.$item.find('.js_item_remove');        this.$sizes = this.$item.find('.js_item_size');        this.$price = this.$item.find('.js_item_price');        this.prevAmount = this.$amountsChanger.val();        this.$amountsChanger.on('change', this.amountChanged.bind(this));        this.$removeBtn.on('click', this.remove.bind(this));    }    /**     * Add product to cart     * @param e     */    WholesaleProductCartItem.prototype.addToCart = function () {        var products = {}, sizes = {}, amountsDiff = this.$amountsChanger.val() - this.prevAmount;        this.prevAmount = this.$amountsChanger.val();        this.$sizes.each(function () {            sizes[$(this).data('id')] = amountsDiff;        });        products[this.$item.data('id')] = sizes;        $.ajax({            url: Routing.generate('cart_add_wholesale'),            data: {products: products},            dataType: "json",            type: "POST",            success: this.successSubmit.bind(this),            error: function (message) {                alert(message.status + ' ' + message.statusText);            }        });    };    /**     * Success add to cart handler     * @param response     */    WholesaleProductCartItem.prototype.successSubmit = function (response) {        updatePageData(response);        this.updatePrice();        if(response.totalCount == 0) {            window.location.reload();        }    };    /**     * Remove item from cart     * @param response     */    WholesaleProductCartItem.prototype.remove = function () {        $.ajax({            url: Routing.generate('cart_remove_item', {id: this.$item.data('id')}),            dataType: "json",            type: "POST",            success: function (response) {                this.successSubmit(response);                this.destroy();            }.bind(this),            error: function (message) {                alert(message.status + ' ' + message.statusText);            }        });    };    /**     * Do required on amount changing things     */    WholesaleProductCartItem.prototype.amountChanged = function () {        this.addToCart();    };    /**     * Destroy     */    WholesaleProductCartItem.prototype.destroy = function () {        this.$item.remove();    };    /**     * Update total model price     */    WholesaleProductCartItem.prototype.updatePrice = function () {        var amount = this.$amountsChanger.val(),            price = this.$price.data('price') * amount * this.$sizes.length;        this.$price.text(parseFloat(price).toFixed(2));    };    return WholesaleProductCartItem;})();$(window).ready(function () {    $('.js_cart_item').each(function () {        new WholesaleProductCartItem($(this));    });});